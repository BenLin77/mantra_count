# 法會功能和日期顯示改進

## 實現的功能

### 1. 日期顯示改進
- **星期顯示**：所有日期現在都會顯示星期幾
- **用戶資料頁面**：註冊時間和唸誦記錄日期都包含星期信息
- **管理員頁面**：用戶詳情中的記錄日期也包含星期
- **格式**：`2024-01-15 (週一)` 的格式

### 2. 法會管理系統

#### 法會模型 (Ceremony)
- **法會名稱**：例如「蓮師薈供法會」、「阿彌陀佛法會」
- **法會描述**：詳細說明法會的意義和內容
- **日期範圍**：開始日期和結束日期
- **啟用狀態**：可以啟用或停用法會
- **自動關聯**：在法會期間內的唸誦記錄會自動關聯到該法會

#### 管理功能
- **創建法會**：管理員可以創建新的法會
- **編輯法會**：修改法會信息、日期範圍和狀態
- **刪除法會**：只有沒有相關記錄的法會才能刪除
- **法會列表**：查看所有法會及其統計信息

#### 唸誦記錄改進
- **法會關聯**：每個唸誦記錄會自動關聯到當前啟用的法會
- **顯示優化**：在記錄列表中顯示所屬法會
- **統計分析**：可以按法會統計唸誦次數

### 3. 用戶界面改進

#### 首頁
- 今日記錄顯示法會信息
- 清晰的法會標識

#### 用戶資料頁面
- 最近7天記錄包含星期和法會信息
- 更詳細的記錄展示

#### 管理員面板
- 新增法會管理入口
- 法會統計和分析

### 4. 日期平分到法會的實現

系統會自動將用戶的唸誦記錄分配到對應的法會：

1. **自動分配**：當用戶記錄唸誦時，系統會檢查當前日期是否在任何啟用法會的時間範圍內
2. **智能關聯**：如果有多個重疊的法會，系統會選擇最新創建的啟用法會
3. **歷史兼容**：已存在的記錄不會受到影響，只有新記錄會自動關聯法會

## 使用方法

### 管理員操作
1. 登入管理員帳號
2. 進入「法會管理」
3. 點擊「創建新法會」
4. 填寫法會信息和日期範圍
5. 啟用法會

### 用戶體驗
1. 用戶正常記錄唸誦
2. 系統自動關聯到當前法會
3. 在個人資料中查看記錄時，可以看到所屬法會
4. 日期顯示包含星期信息，更容易識別

## 技術實現

### 數據庫結構
- 新增 `ceremony` 表
- 在 `mantra_record` 表中添加 `ceremony_id` 外鍵
- 建立模型間的關聯關係

### 核心方法
- `MantraRecord.get_formatted_date()`：格式化日期顯示
- `MantraRecord.get_weekday_name()`：獲取星期名稱
- `Ceremony.get_current_ceremony()`：獲取當前法會
- `User.get_formatted_created_at()`：格式化註冊時間

### 自動化邏輯
- 創建新記錄時自動檢查並關聯法會
- 日期顯示統一使用格式化方法
- 模板中智能顯示法會信息

這個系統實現了您要求的兩個主要功能：
1. ✅ 日期顯示包含星期幾
2. ✅ 日期可以平分到不同的法會上

用戶的唸誦記錄現在會根據日期自動分配到對應的法會，管理員可以方便地管理法會，而所有日期顯示都包含了星期信息，讓使用者更容易識別時間。 